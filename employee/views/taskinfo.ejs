<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css" />
<script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
<script>
    const notyf = new Notyf({
        duration: 1500,
        position: { x: "left", y: "bottom" },
    });

    function chosen(taskid){
        fetch(`/taskinfo/chosen?taskid=${taskid}`, {method: 'GET'})
        .then(() => {
            window.location.reload();
        }).catch((err) => console.log(err))
    }

    function verify(taskid, typeOfTask){
        fetch(`/taskinfo/verify?taskid=${taskid}&typeOfTask=${typeOfTask}`, {method: 'GET'})
        .then(async (res)=>{
            const resp = await res.json()
            if(resp.success){
                notyf.success("Task verified!");
                setTimeout(() => {
                    window.location.href = '/profile'
                }, 1500)
            }
        })
        .catch(err=>console.log(err))
    }

</script>
<h1 id="details_heading">Task Details</h1>
<div id="details_flex">
    <div id="details_title"><%=task.title%></div>
    <div id='details_type'>
        <div><%=task.typeOfTask%></div>
    </div>
    <div id='details_type'>
        Value: <div><%=task.caterpillarValue%></div>
    </div>
</div>
<div id="task_description"><%=task.description%></div>
<div id="details_btn">
<% if (task.isAccepted == true && task.isCompleted == false){ %>
    <button type="button" class="btn-choose" onclick="verify('<%=task._id%>','<%=task.typeOfTask%>')">
        Verify
    </button>
<% } else if(task.isAccepted == false && task.isCompleted == false) { %>
    <button type="button" class="btn-choose" onclick="chosen('<%=task._id%>')">
        Choose
    </button>
<% } else if(task.isAccepted == true && task.isCompleted == true){%>
    <p>
        You have completed this task.
    </p>
    <% } %>
</div>
